<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fine Tuner</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #faf9f7;
      min-height: 100vh;
      margin: 0;
      line-height: 1.6;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 20px;
      border: 1px solid #e8e5e0;
      box-shadow: 0 10px 40px rgba(139, 112, 87, 0.08);
      padding: 40px;
    }

    .editable {
      min-height: 250px; /* Increased height from 160px */
      border: 1px solid #e0d5c7;
      border-radius: 12px;
      padding: 16px;
      font-family: 'SF Mono', Monaco, monospace;
      background: #fefdfb;
      white-space: pre-wrap;
      overflow-y: auto;
    }

    /* Placeholder imitation */
    .editable:empty:before {
      content: attr(data-placeholder);
      color: #aaa;
    }

    button {
      padding: 10px 18px;
      margin-right: 10px;
      margin-bottom: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      border: 1px solid #e0d5c7;
      border-radius: 10px;
      transition: all 0.2s ease;
      font-weight: 500;
      background: #fefdfb;
      color: #8b7057;
    }

    button:hover {
      transform: translateY(-1px);
      background: #f7f5f3;
      border-color: #c4a484;
      box-shadow: 0 3px 10px rgba(139, 112, 87, 0.1);
    }

    .copy-btn {
      border-color: #b8a990;
      color: #8b7057;
      background: #f7f5f3;
    }

    .copy-btn:hover {
      background: #f2ede6;
      border-color: #9d8670;
    }

    .clear-btn {
      border-color: #d4c4a8;
      color: #a0916d;
      background: #faf9f7;
    }

    .clear-btn:hover {
      background: #f5f2ee;
      border-color: #b8a990;
    }

    .step {
      background: #ffffff;
      padding: 28px;
      margin-bottom: 24px;
      border-radius: 16px;
      border: 1px solid #f0ebe4;
      transition: all 0.2s ease;
      box-shadow: 0 2px 12px rgba(139, 112, 87, 0.04);
    }

    .step:hover {
      border-color: #e0d5c7;
      background: #fefdfb;
      box-shadow: 0 4px 20px rgba(139, 112, 87, 0.08);
    }

    .step h3 {
      margin: 0 0 18px 0;
      color: #5d5043;
      font-size: 1.3rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .step-number {
      background: #8b7057;
      color: #ffffff;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 15px;
    }

    .convert-btn {
      border-color: #b8a990;
      color: #8b7057;
      background: #f7f5f3;
    }

    .convert-btn:hover {
      background: #f2ede6;
      border-color: #9d8670;
    }

    /* ======= New Part Section Styling ======= */
    .part-section {
      padding: 25px;
      border-radius: 16px;
      margin-bottom: 40px;
    }

    .part-section h3 {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 25px;
      text-align: center;
      border-bottom: 2px solid rgba(0,0,0,0.1);
      padding-bottom: 10px;
    }

    .part4 { 
      background: #f9f3ff; 
      border-left: 5px solid #9b59b6; 
    }
    
    .part4 h3 { 
      color: #9b59b6; 
    }

    .part5 { 
      background: #f0f7ff; 
      border-left: 5px solid #4a90e2; 
    }
    
    .part5 h3 { 
      color: #4a90e2; 
    }

    .yellow-highlight {
      background-color: #fbfb00;
      border-radius: 4px;
      padding: 1px 4px;
    }

    #message {
      position: fixed;
      top: 24px;
      right: 24px;
      background: #ffffff;
      color: #5d5043;
      padding: 14px 20px;
      border-radius: 12px;
      font-weight: 500;
      border: 1px solid #e0d5c7;
      box-shadow: 0 6px 20px rgba(139, 112, 87, 0.15);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1000;
      font-size: 0.9rem;
    }

    #message.show {
      transform: translateX(0);
    }

    hr {
      border: none;
      height: 1px;
      background: #e8e5e0;
      margin: 30px 0;
      border-radius: 1px;
    }
    
    .input-boxes-container {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .input-boxes-container .editable {
      flex: 1;
    }

    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      .container {
        padding: 25px;
      }

      .step {
        padding: 20px;
      }
      
      .input-boxes-container {
        flex-direction: column;
        gap: 15px;
      }

      .button-group {
        flex-direction: column;
      }

      button {
        margin-right: 0;
        width: 100%;
      }
    }

    script[type="text/plain"] {
      display: none;
    }

    #scrollToTopBtn {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 999;
      border: none;
      outline: none;
      background-color: #8b7057;
      color: white;
      cursor: pointer;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 15px rgba(139, 112, 87, 0.3);
      transition: all 0.3s ease;
    }

    #scrollToTopBtn.visible {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    #scrollToTopBtn:hover {
      background-color: #5d5043;
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(139, 112, 87, 0.4);
    }

    #scrollToTopBtn svg {
      width: 24px;
      height: 24px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="stepsContainer"></div>
    <div id="message"></div>
  </div>

  <!-- Prompts -->
  <script type="text/plain" id="prompt5">Fine Tuning Needed Sentences:

    Instructions for Fine Tuning:
    
    Below is the Transcript of an English Talk by sadhguru addressing Audience.
    The talk is made up of blocks of points.
    Each point is made up of blocks of thoughts.
    Each thought is made up of blocks of information.
    
  We have used … , ; - . and ? to mark the boundaries of Information blocks, thoughts and ideas.
  
  … indicates a pause in between the sentences.
  , indicates a pause between meaningful chunks that make up the sentence.
  ; indicates connected sentences.
  - indicates additional information related to the main idea of the sentence.
  
  
  I am also giving the telugu translation for the same.Now in the telugu translation I have added some tags.
  <Gesture> </Gesture> indicates the portion of the sentences for which there is a corresponding significant body language shown in the video.
  
  <Context> </Context> indicates the portion of the sentences for which i am looking for a more contextual word or phrase. 
  
  <Intention> </Intention> indicates the portion of the sentences for which i am looking for a sentence that expresses the actual intent behind using that sentence or words.
  
  Below are the instructions for the the tag <Context> </Context>:
  Assume you are very good at telugu language, basically good at finding the right telugu words for a particular english word based on the context in which the word occurs. you also explain what this word is conveying here in this context in English.
  
  
  
  Below are the instructions for the the tag <Intention> </Intention>:
  
  Based on the context in which this sentence is occurring, and based on the picture that is being created before and after this sentence, identify the intention of the speaker. what he actually is trying to convey. Rather than just relying on the words and doing the word to word translation, grasp the intention based on the context and express it directly in telugu in a colloquial way. No need to follow the exact word to word based translation. The intention needs to be expressed here.
  
  [... REST OF THE PROMPT CONTENT REMAINS THE SAME ...]
  
  Give the results in the same order in which the tags appear in the script.
  
  Below are the English and Telugu scripts.
</script>

<script>
  const message = document.getElementById('message');
  
  function getPrompt(step) {
    const promptElement = document.getElementById(`prompt${step}`);
    if (promptElement) {
      return promptElement.textContent.trim();
    }
    console.error(`Prompt for step ${step} not found!`);
    return "";
  }

  function handlePaste(step, boxNumber = 1) {
    navigator.clipboard.read().then(items => {
      let foundHtml = false;
      for (const item of items) {
        if (item.types.includes('text/html')) {
          item.getType('text/html').then(blob => {
            blob.text().then(html => {
              let targetBox = document.getElementById(`input5_${boxNumber}`);
              if (targetBox) {
                targetBox.innerHTML = html;
                showMessage(`✅ Pasted rich text into Box ${boxNumber}`);
              }
            });
          });
          foundHtml = true;
          break;
        }
      }
      if (!foundHtml) {
        navigator.clipboard.readText().then(text => {
          let targetBox = document.getElementById(`input5_${boxNumber}`);
          if (targetBox) {
            targetBox.innerText = text;
            showMessage(`✅ Pasted plain text into Box ${boxNumber}`);
          }
        });
      }
    }).catch(err => {
      console.error('Failed to read clipboard contents: ', err);
      showMessage("❌ Could not paste from clipboard.");
    });
  }

  function handleClear(step) {
    if (step === 5) {
      const box1 = document.getElementById('input5_1');
      const box2 = document.getElementById('input5_2');
      if (box1) box1.innerHTML = "";
      if (box2) box2.innerHTML = "";
    }
    showMessage("🗑️ Cleared input boxes");
  }

  function clearAllInputs() {
    const box1 = document.getElementById('input5_1');
    const box2 = document.getElementById('input5_2');
    if (box1) box1.innerHTML = "";
    if (box2) box2.innerHTML = "";

    const dualHighlighterBox = document.getElementById('dual-highlight-box');
    if (dualHighlighterBox) {
      dualHighlighterBox.innerHTML = '';
    }

    showMessage("🗑️ All input boxes cleared");
  }

  function handleCopy(step) {
    if (step !== 5) return; 

    // Action 1: Handle Dual Highlighter
    const teluguInputBox = document.getElementById('input5_2');
    const dualHighlighterBox = document.getElementById('dual-highlight-box');
    if (teluguInputBox && dualHighlighterBox) {
      dualHighlighterBox.innerHTML = teluguInputBox.innerHTML;
      applyDualHighlight();
    }

    // Action 2: Transform Telugu tags in the input box itself
    transformTeluguTags();

    // Action 3: Perform the copy action
    const inputBox1 = document.getElementById(`input${step}_1`);
    const inputBox2 = document.getElementById(`input${step}_2`);
    const text1 = inputBox1 ? inputBox1.innerText.trim() : "";
    const text2 = inputBox2 ? inputBox2.innerText.trim() : "";
    const finalText =
      getPrompt(step) +
      "\n\nEnglish Script:\n" +
      text1 +
      "\n\nTagged Telugu Script:\n" +
      text2;

    navigator.clipboard.writeText(finalText).then(() => {
      showMessage("✅ Highlights applied, tags converted & prompt copied!");
    });
  }

  function showMessage(msg) {
    message.textContent = msg;
    message.classList.add('show');
    clearTimeout(showMessage.timeout);
    showMessage.timeout = setTimeout(() => {
      message.classList.remove('show');
    }, 3000);
  }

  function transformTeluguTags() {
    const editableDiv = document.getElementById('input5_2');
    if (!editableDiv) {
      return;
    }

    let html = editableDiv.innerHTML;

    // Preserve existing tags by replacing them with placeholders
    html = html.replace(/<context>/gi, '§§C_START§§').replace(/<\/context>/gi, '§§C_END§§');
    html = html.replace(/<intention>/gi, '§§I_START§§').replace(/<\/intention>/gi, '§§I_END§§');

    // Convert B/I/SPAN tags to placeholders
    html = html.replace(/<(i|em)\b[^>]*>(.*?)<\/\1>/gi, '§§I_START§§$2§§I_END§§');
    html = html.replace(/<span\b[^>]*font-style:\s*italic[^>]*>(.*?)<\/span>/gi, '§§I_START§§$1§§I_END§§');
    html = html.replace(/<(b|strong)\b[^>]*>(.*?)<\/\1>/gi, '§§C_START§§$2§§C_END§§');
    html = html.replace(/<span\b[^>]*font-weight:\s*(?:bold|700|800|900)[^>]*>(.*?)<\/span>/gi, '§§C_START§§$1§§C_END§§');

    // Strip remaining HTML tags to get clean text
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html;
    let textContent = tempDiv.textContent || tempDiv.innerText;

    // Convert placeholders back to final tags
    textContent = textContent.replace(/§§I_START§§/g, '<intention>').replace(/§§I_END§§/g, '</intention>');
    textContent = textContent.replace(/§§C_START§§/g, '<context>').replace(/§§C_END§§/g, '</context>');

    editableDiv.innerText = textContent.trim();
  }

  function pasteIntoDualHighlighter() {
    const box = document.getElementById('dual-highlight-box');
    if (box) {
      box.focus();
      navigator.clipboard.read().then(items => {
        for (const item of items) {
          if (item.types.includes('text/html')) {
            item.getType('text/html').then(blob => blob.text().then(html => {
              box.innerHTML = html;
              showMessage('✅ Pasted rich text!');
            }));
            return;
          }
        }
        navigator.clipboard.readText().then(text => {
          box.innerText = text;
          showMessage('✅ Pasted plain text!');
        });
      });
    }
  }

  function applyDualHighlight() {
    const box = document.getElementById('dual-highlight-box');
    if (!box || !box.innerHTML.trim()) {
      return;
    }

    const greenColor = '#05fd05';
    const yellowColor = '#fbfb00';

    const allSpans = Array.from(box.querySelectorAll('span'));

    allSpans.forEach(span => {
      if (span.style.fontWeight === 'bold' || parseInt(span.style.fontWeight) >= 700) {
        span.style.fontWeight = 'normal';
        span.style.backgroundColor = greenColor;
      }
      
      if (span.style.fontStyle === 'italic') {
        span.style.fontStyle = 'normal';
        span.style.backgroundColor = yellowColor;
      }
    });

    const boldTags = Array.from(box.querySelectorAll('b, strong'));
    boldTags.forEach(tag => {
      const newSpan = document.createElement('span');
      newSpan.style.backgroundColor = greenColor;
      newSpan.innerHTML = tag.innerHTML;
      tag.parentNode.replaceChild(newSpan, tag);
    });
    
    const italicTags = Array.from(box.querySelectorAll('i, em'));
    italicTags.forEach(tag => {
      const newSpan = document.createElement('span');
      newSpan.style.backgroundColor = yellowColor;
      newSpan.innerHTML = tag.innerHTML;
      tag.parentNode.replaceChild(newSpan, tag);
    });
  }

  function clearDualHighlighter() {
    const box = document.getElementById('dual-highlight-box');
    if (box) {
      box.innerHTML = '';
      showMessage('🗑️ Dual highlighter box cleared.');
    }
  }

  function copyFromDualHighlighter() {
    const box = document.getElementById('dual-highlight-box');
    if (!box || !box.innerHTML.trim()) {
      showMessage('⚠️ Box is empty, nothing to copy.');
      return;
    }
    
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = box.innerHTML;

    tempDiv.querySelectorAll('.green-highlight').forEach(span => {
      span.style.backgroundColor = '#05fd05';
    });
    tempDiv.querySelectorAll('.yellow-highlight').forEach(span => {
      span.style.backgroundColor = '#fbfb00';
    });
    
    tempDiv.querySelectorAll('span').forEach(span => span.removeAttribute('class'));

    try {
      const htmlContent = tempDiv.innerHTML;
      const textContent = box.innerText;
      const blobHtml = new Blob([htmlContent], { type: 'text/html' });
      const blobText = new Blob([textContent], { type: 'text/plain' });
      const clipboardItem = new ClipboardItem({ 'text/html': blobHtml, 'text/plain': blobText });
      navigator.clipboard.write([clipboardItem]).then(() => {
        showMessage('✅ Copied dual-highlighted text!');
      });
    } catch (error) {
      console.error('Failed to copy rich text:', error);
      showMessage('❌ Could not copy content.');
    }
  }

  const container = document.getElementById('stepsContainer');

  function createPart(title, steps, className) {
    const partDiv = document.createElement('div');
    partDiv.className = `part-section ${className}`;
    partDiv.innerHTML = `<h3>${title}</h3>`;
    steps.forEach(i => partDiv.appendChild(createStep(i)));
    return partDiv;
  }

  function createStep(i) {
    const stepDiv = document.createElement('div');
    stepDiv.className = 'step';

    let textarea = "";
    if (i === 5) {
      textarea = `
        <div class="input-boxes-container">
            <div id="input5_1" class="editable" contenteditable="true" data-placeholder="Paste English script here..."></div>
            <div id="input5_2" class="editable" contenteditable="true" data-placeholder="Paste Telugu script with bold/italic for tagging..."></div>
        </div>
      `;
    }

    let buttonGroup = "";
    if (i === 5) {
      buttonGroup = `
        <div class="button-group">
          <button class="copy-btn" onclick="handleCopy(${i})">📋 Generate & Copy Prompt</button> 
          <button class="clear-btn" onclick="handleClear(${i})">🗑️ Clear</button>
        </div>`;
    }

    stepDiv.innerHTML = `
      ${textarea}
      ${buttonGroup}
    `;
    return stepDiv;
  }

  function createDualHighlighterTool() {
    const toolDiv = document.createElement('div');
    toolDiv.className = 'part-section part5';
    toolDiv.innerHTML = `
      <h3>Dual Style Highlighter</h3>
      <div id="dual-highlight-box" class="editable" contenteditable="true" data-placeholder="Your Telugu script with highlights will appear here automatically..."></div>
      <div class="button-group" style="justify-content: center; margin-top: 20px;">
        <button class="convert-btn" style="background-color: #4a90e2; color: white; border-color: #357ABD;" onclick="pasteIntoDualHighlighter()">📋 Paste from Clipboard</button>
        <button class="clear-btn" onclick="clearDualHighlighter()">🗑️ Clear</button>
      </div>
    `;
    return toolDiv;
  }

  container.appendChild(createPart("Fine Tuning Tool", [5], "part4"));
  container.appendChild(createDualHighlighterTool());

  document.addEventListener('DOMContentLoaded', function() {
    const scrollToTopBtn = document.getElementById('scrollToTopBtn');

    if (scrollToTopBtn) {
      window.onscroll = function() {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
          scrollToTopBtn.classList.add("visible");
        } else {
          scrollToTopBtn.classList.remove("visible");
        }
      };

      scrollToTopBtn.addEventListener('click', () => {
        const firstPart = document.querySelector('.part4');
        if (firstPart) {
          firstPart.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    }
  });
</script>

<button id="scrollToTopBtn" title="Scroll to Top">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
    <polyline points="18 15 12 9 6 15"></polyline>
  </svg>
</button>

</body>
</html>